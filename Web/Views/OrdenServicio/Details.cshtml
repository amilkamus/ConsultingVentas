@model Web.Models.OrdenServicio.OrdenServicioViewModel

@{ ViewBag.Title = "Detalle Orden de Servicio";
    Layout = "~/Views/Shared/_LayoutMain.cshtml"; }
<style type="text/css">
    #detalle th, #detalle td {
        padding: 5px;
    }

    .fondoCabecera {
        background-color: rgb(252,213,180);
    }
</style>
@section Scripts{
    <script src=@Url.Content("~/Scripts/js/angular/controller/ordenServicio/ordenServicioController.js")></script>
}
<h3>Detalle de Orden de Servicio</h3>

<div style="background-color:white" ng-controller="ordenServicioController">
    <input type="hidden" id="IdNumeroOrdenServicio" ng-model="model.ID" value="@ViewBag.IdNumeroOrdenServicio" />
    <input type="hidden" id="IdCotizacion" value="@ViewBag.IdCotizacion" />
    <div class="row" style="margin-left:40px">
        <div>
            <p>
                <table border="0" width="95%" style="font-weight:bold">
                    <tr>
                        <td Width="38%"><img src="~/Imagen/LogoITS.png" /></td>
                        <td Width="36%" Font-Bold="true" Font-Size="20px" valign="bottom">ORDEN DE SERVICIO</td>
                        <td Width="24%"></td>
                    </tr>
                </table>
            </p>
            <p>
                <table id="detalle" border="1" width="95%">
                    <tr>
                        <th width="20%" class="fondoCabecera">ORDEN DE SERVICIO N°</th>
                        <td>@Html.DisplayFor(model => model.OrdenServicio.NumeroOrdenServicio)</td>
                        <th width="20%" class="fondoCabecera">COTIZACION N°</th>
                        <td>@Html.DisplayFor(model => model.OrdenServicio.NumeroCotizacion)</td>
                    </tr>
                    <tr>
                        <th colspan="4" class="fondoCabecera" style="text-align:center!important">DATOS DEL CLIENTE</th>
                    </tr>
                    <tr>
                        <th class="fondoCabecera">Cliente:</th>
                        <td colspan="3">@Html.DisplayFor(model => model.Cotizacion.Solicitante)</td>
                    </tr>
                    <tr>
                        <th class="fondoCabecera">RUC:</th>
                        <td colspan="3">@Html.DisplayFor(model => model.Cotizacion.RUC)</td>
                    </tr>
                    
                    @if (Model.Cliente.empresaDomicilio == null)
                    {
                        <tr>
                            <th class="fondoCabecera">Dirección legal:</th>
                            <td colspan="3">@Html.DisplayFor(model => model.Cliente.titularDomicilio)</td>
                        </tr>
                    }
                    else
                    {
                        <tr>
                            <th class="fondoCabecera">Dirección legal:</th>
                            <td colspan="3">@Html.DisplayFor(model => model.Cliente.empresaDomicilio)</td>
                        </tr>
                    }
                    
                    <tr>
                        <th class="fondoCabecera">Contacto:</th>
                        <td colspan="3">@Html.DisplayFor(model => model.Cotizacion.Contacto)</td>
                    </tr>
                    <tr>
                        <th class="fondoCabecera">Email:</th>
                        <td colspan="3">@Html.DisplayFor(model => model.Cotizacion.Email)</td>
                    </tr>
                    <tr>
                        <th class="fondoCabecera">Teléfono:</th>
                        <td colspan="3">@Html.DisplayFor(model => model.Cotizacion.Telefono)</td>
                    </tr>
                    <tr>
                        <th class="fondoCabecera">Nombre del producto:</th>
                        <td colspan="3">@Html.DisplayFor(model => model.Cotizacion.DescripcionProducto)</td>
                    </tr>
                    <tr>
                        <th colspan="4" class="fondoCabecera" style="text-align:center!important">EMISIÓN DE DOCUMENTOS</th>
                    </tr>
                    <tr>
                        <th class="fondoCabecera">Tipo de documento</th>
                        <td>@Html.DisplayFor(model => model.Cotizacion.TipoDocumentoSolicitado)</td>
                        <th class="fondoCabecera">Informes en físico:</th>
                        <td>@(Model.Cotizacion.EmisionDigital?"Si":"No")</td>
                    </tr>
                    <tr>
                        <th class="fondoCabecera">N° Copias:</th>
                        <td colspan="3">@Html.DisplayFor(model => model.OrdenServicio.NumeroCopiasInforme)</td>
                    </tr>
                    <tr>
                        <th class="fondoCabecera">Otros / Observaciones:</th>
                        <td colspan="3">@Html.DisplayFor(model => model.OrdenServicio.ObservacionesInforme)</td>
                    </tr>
                    <tr>
                        <th colspan="4" class="fondoCabecera" style="text-align:center!important">PREPARACIÓN DE MATERIALES</th>
                    </tr>
                    <tr>
                        <th class="fondoCabecera">Dirección de envío:</th>
                        <td colspan="3">@Html.DisplayFor(model => model.OrdenServicio.DireccionEnvioMateriales)</td>
                    </tr>
                    <tr>
                        <th class="fondoCabecera">Fecha de envío de materiales:</th>
                        <td colspan="3">@Html.DisplayFor(model => model.OrdenServicio.FechaEnvioMateriales)</td>
                    </tr>
                    <tr>
                        <th class="fondoCabecera">Contacto:</th>
                        <td colspan="3">@Html.DisplayFor(model => model.OrdenServicio.ContactoMateriales)</td>
                    </tr>
                    <tr>
                        <th colspan="4" class="fondoCabecera" style="text-align:center!important">INSPECCIÓN / MUESTREO</th>
                    </tr>
                    <tr>
                        <th class="fondoCabecera">Contacto:</th>
                        <td colspan="3">@Html.DisplayFor(model => model.OrdenServicio.ContactoInspeccion)</td>
                    </tr>
                    <tr>
                        <th class="fondoCabecera">Email:</th>
                        <td colspan="3">@Html.DisplayFor(model => model.OrdenServicio.EmailInspeccion)</td>
                    </tr>
                    <tr>
                        <th class="fondoCabecera">Teléfono:</th>
                        <td colspan="3">@Html.DisplayFor(model => model.OrdenServicio.TelefonoInspeccion)</td>
                    </tr>
                    <tr>
                        <th class="fondoCabecera">Coordinador de inspección:</th>
                        <td colspan="3">@Html.DisplayFor(model => model.OrdenServicio.CoordinadorInspeccion)</td>
                    </tr>
                    <tr>
                        <th class="fondoCabecera">Lugar de Inspección / Muestreo:</th>
                        <td colspan="3">@Html.DisplayFor(model => model.Cotizacion.LugarInspeccionMuestreo)</td>
                    </tr>
                    <tr>
                        <th class="fondoCabecera">Fecha de Inspección / Muestreo:</th>
                        <td colspan="3">@Html.DisplayFor(model => model.OrdenServicio.FechaInspeccion)</td>
                    </tr>
                    <tr>
                        <th class="fondoCabecera">Hora de Inspección / Muestreo:</th>
                        <td colspan="3">@Html.DisplayFor(model => model.OrdenServicio.HoraInspeccion)</td>
                    </tr>
                    <tr>
                        <th class="fondoCabecera">Actividad a realizar:</th>
                        <td colspan="3">@Html.DisplayFor(model => model.OrdenServicio.TipoServicioInspeccion)</td>
                    </tr>
                    <tr>
                        <th class="fondoCabecera">Nombre del producto:</th>
                        <td colspan="3">@Html.DisplayFor(model => model.OrdenServicio.NombreProductoInspeccion)</td>
                    </tr>
                    <tr>
                        <th class="fondoCabecera">Cantidad de Lote:</th>
                        <td>@Html.DisplayFor(model => model.OrdenServicio.CantidadLoteInspeccion)</td>
                        <th class="fondoCabecera">Tipo de empaque/envase:</th>
                        <td>@Html.DisplayFor(model => model.OrdenServicio.PresentacionInspeccion)</td>
                    </tr>
                    <tr>
                        <th class="fondoCabecera">Código(s) de Lote:</th>
                        <td colspan="3">@Html.DisplayFor(model => model.OrdenServicio.CodigosLoteInspeccion)</td>
                    </tr>
                    <tr>
                        <th class="fondoCabecera">Otros / Observaciones:</th>
                        <td colspan="3">@Html.DisplayFor(model => model.OrdenServicio.ObservacionesInspeccion)</td>
                    </tr>
                    @{ var listaProductos = (from d in Model.Detalles
                                              select d.producto).ToList().Distinct(); }
                    <tr style="border:hidden !important;padding:0">
                        <td colspan="4" style="padding:0;">
                            <table border="1" width="100%">
                                <tr>
                                    <td colspan="5" style="border-left:hidden;border-right:hidden">&nbsp;</td>
                                </tr>
                                <tr>
                                    <th colspan="5" class="fondoCabecera" style="text-align:center">ENSAYOS</th>
                                </tr>
                                <tr class="fondoCabecera">
                                    <th>Tipo de ensayo</th>
                                    <th>Norma de referencia</th>
                                    <th>Límite de detección</th>
                                    <th>Tipo de servicio *</th>
                                    <th>Cantidad</th>
                                </tr>
                                @foreach (var item in listaProductos)
                                {
                                    <tbody>
                                        <tr>
                                            <th colspan="5" style="text-align:center">@item.nombre</th>
                                        </tr>
                                        @{ var elementosDetalle = (from n in Model.Detalles
                                                                    where n.producto.idProducto == item.idProducto
                                                                    select n).ToList(); }
                                        @foreach (var item2 in elementosDetalle)
                                        {
                                            <tr>
                                                <td>@item2.parametro.ParametroDescripcion</td>
                                                <td>@item2.parametro.Metodologia</td>
                                                <td>@item2.parametro.LimiteDeteccion</td>
                                                <td>@item2.tipoParametro.TipoParametroDescripcion</td>
                                                <td>@item2.productoCotizacion.Cantidad</td>
                                            </tr>
                                        }
                                    </tbody>
                                }
                            </table>
                            <table border="1" width="100%" style="border-top:hidden">
                                <thead>
                                    <tr>
                                        <td colspan="7" style="border-left:hidden;border-right:hidden">&nbsp;</td>
                                    </tr>
                                    <tr class="fondoCabecera">
                                        <th colspan="7" style="text-align:center">INSPECCIÓN / MUESTREO</th>
                                    </tr>
                                    <tr class="fondoCabecera">
                                        <th>Producto / Proceso / Servicio / Instalación a inspeccionar / muestrear</th>
                                        <th>Actividad de Inspección / Muestreo</th>
                                        <th>Método / Procedimiento de Inspección / Muestreo</th>
                                        <th>Documento normativo</th>
                                        <th>Plan de muestreo / Nivel / NCA</th>
                                        <th>Tipo de servicio *</th>
                                        <th>Cantidad</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.Inspeccion)
                                    {
                                        <tr>
                                            <td>@item.Producto</td>
                                            <td>@item.Actividad</td>
                                            <td>@item.Procedimiento</td>
                                            <td>@item.Documento</td>
                                            <td>@item.PlanMuestreo</td>
                                            <td>@item.TipoServicio</td>
                                            <td>@item.Cantidad</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                            <table border="1" width="100%" style="border-top:hidden">
                                <tr>
                                    <td colspan="4" style="border-left:hidden;border-right:hidden">&nbsp;</td>
                                </tr>
                                <tr>
                                    <th colspan="4" class="fondoCabecera" style="text-align:center">CERTIFICADOS / INFORMES</th>
                                </tr>
                                <tr class="fondoCabecera">
                                    <th>Documento</th>
                                    <th>Norma de referencia</th>
                                    <th>Tipo de servicio *</th>
                                    <th>Cantidad</th>
                                </tr>
                                @{ if (Model.Certificados.Count == 0)
                                    {
                                        <tr><td>&nbsp;</td><td>&nbsp;</td></tr>
                                    } }
                                @foreach (var certificado in Model.Certificados)
                                {
                                    <tr>
                                        <td>@certificado.Documento</td>
                                        <td>@certificado.NormaReferencia</td>
                                        <td>@certificado.TipoServicio</td>
                                        <td>@certificado.Cantidad</td>
                                    </tr>
                                }
                            </table>
                            <table border="1" width="100%" style="border:hidden;">
                                <tr>
                                    <td>* AC: Acreditado, NAC: No Acreditado, SUB: Subcontratado</td>
                                </tr>
                            </table>
                            <table border="1" width="100%" style="border-top:hidden">
                                <tr>
                                    <td colspan="4" style="border-left:hidden;border-right:hidden">&nbsp;</td>
                                </tr>
                                <tr>
                                    <th class="fondoCabecera" style="text-align:center">OBSERVACIONES</th>
                                </tr>
                                <tr>
                                    <td>@Model.Cotizacion.Observaciones</td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="4" style="border-left:hidden;border-right:hidden">&nbsp;</td>
                    </tr>
                    <tr>
                        <th colspan="3" style="text-align:right" class="fondoCabecera">Registrado por:</th>
                        <td>@Model.NombreUsuario</td>
                    </tr>
                    <tr>
                        <th colspan="3" style="text-align:right" class="fondoCabecera">Fecha:</th>
                        <td>@Model.OrdenServicio.FechaRegistro.ToString("dd/MM/yyyy")</td>
                    </tr>
                </table>
            </p>
        </div>
    </div>
    <br />
</div>
<p style="width:95%; text-align:center">
    @Html.ActionLink("Editar", "Edit", new { id = Model.OrdenServicio.ID }, new { @class = "btn btn-sm btn-primary" }) |
    @Html.ActionLink("Imprimir", "PrintOrdenServicio", new { id = Model.OrdenServicio.ID }, new { @class = "btn btn-sm btn-primary" }) |
    @Html.ActionLink("Regresar a Listado", "Index", null, new { @class = "btn btn-sm btn-danger cancelar" })
</p>